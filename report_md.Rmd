---
title: "Infant Touchscreen Use and Sleep Problems"
author: "Jessica Scarborough"
date: "5/7/2017"
output:
  html_document:
    theme: journal
    toc: true
    toc_depth: 4
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
require(truncnorm)
require(ggplot2)
```

# Report Description

This report examines data simulation, exporation, and modeling analysis. The exploration portion of the project utilizes data visualization, normality testing, and correlation analysis. Modeling will begin with simple regression, and then move to multivariate multiple regression, ending with path analysis. 

**Predictor variables:**

* Age
* Gender
* Background TV
* Touchscreen use
* Night-time sleep duration
* Daytime sleep duration
* Average number of night awakenings
* Sleep onset

**Outcome variables:**

* Night-time sleep duration
* Daytime sleep duration
* Sleep onset
* Average number of night awakenings

# Data Simulation

**Count variables:**
```{r}
total.n <- 715

total.n.6_11 <- 134
total.n.12_18 <- 215
total.n.19_25 <- 179
total.n.26_36 <- 187

# N values for each age group in touchscreen use feature
screen.n.6_11 <- 123
screen.n.12_18 <- 194
screen.n.19_25 <- 145
screen.n.26_36 <- 151

# N values for each age group in background tv feature
tv.n.6_11 <- 123
tv.n.12_18 <- 194
tv.n.19_25 <- 145
tv.n.26_36 <- 151

```

**Touchscreen Variables:**
```{r}
screen.mean.6_11 <- 8.53
screen.mean.12_18 <- 18.80
screen.mean.19_25 <- 25.18
screen.mean.26_36 <- 44.11

screen.sd.6_11 <- 15.54
screen.sd.12_18 <- 36.83
screen.sd.19_25 <- 37.46
screen.sd.26_36 <- 47.75
```




**Onset Variables**:
```{r}
onset.n.6_11 <- 116
onset.n.12_18 <- 177
onset.n.19_25 <- 131
onset.n.26_36 <- 130

onset.sd.6_11 <- 23.69
onset.sd.12_18 <- 16.53
onset.sd.19_25 <- 16.97
onset.sd.26_36 <- 27.86

onset.mean.6_11 <- 22.80
onset.mean.12_18 <- 21.54
onset.mean.19_25 <- 22.22
onset.mean.26_36 <- 29.34


```

##Age

I chose to simulate the age data with uniform distribution instead of rnorm, because there's no mention of normal distribution of age in the article. Additionally, normal distribution insinuates that there are very few samples on the lower and upper limits of each age group. This is not indicated in the paper. This makes uniform distribution a better option. 

```{r}
age.6_11 <- runif(n=total.n.6_11, min = 6, max = 11.9)
sd(age.6_11)
# sim sd: ~ 1.7
# original sd: 1.82
age.12_18 <- runif(n=total.n.12_18, min = 12, max = 18.9)
sd(age.12_18)
# sim sd: ~ 2.0
# original sd: 2.19

age.19_25 <- runif(n=total.n.19_25, min = 18, max = 25.9)
sd(age.19_25)
# sim sd: ~ 2.4
# original sd: 2.07

age.26_36 <- rnorm(n=total.n.26_36, mean=30.64, sd=3.07)
age.26_36 <- runif(n=total.n.26_36, min = 26, max = 36.9)
sd(age.26_36)
# sim sd: ~ 3.1
# original sd: 3.07


age <- c(age.6_11, age.12_18, age.19_25, age.26_36)
sd(age)
# sim sd: ~ 8.6
# original sd: 8.26

hist(age)
hist(age.6_11)
hist(age.12_18)
hist(age.19_25)
hist(age.26_36)


# vectors with imputed data for future simulation needs

impute.age.6_11 <- replace(age.6_11, is.na(age.6_11), 
                              mean(age.6_11, na.rm=TRUE))
impute.age.12_18 <- replace(age.12_18, is.na(age.12_18), 
                               mean(age.12_18, na.rm=TRUE))
impute.age.19_25 <- replace(age.19_25, is.na(age.19_25), 
                               mean(age.19_25, na.rm=TRUE))
impute.age.26_36 <- replace(age.26_36, is.na(age.26_36), 
                               mean(age.26_36, na.rm=TRUE))



```

##Touchscreen Use
```{r}
# set.seed(0)

screen.6_11 <- (0.7)* rnorm(n=total.n.6_11, mean=(screen.mean.6_11-2.5), sd=screen.sd.6_11) + 
                (0.3)* rnorm(n=total.n.6_11, mean=3, sd=5)
screen.6_11 <- replace(screen.6_11, screen.6_11<0, 0)
screen.6_11[sample(1:length(screen.6_11), 
                   size = (total.n.6_11-screen.n.6_11), replace = FALSE)] <- NA
hist(screen.6_11)
sd(screen.6_11, na.rm = TRUE)
mean(screen.6_11, na.rm = TRUE)
# Sim mean typically hovers between 6.5-8.5
# Original mean: 7.53

# set.seed(0)
screen.12_18 <- (0.7)* rnorm(n=total.n.12_18, mean=(screen.mean.12_18-4), sd=screen.sd.12_18) + 
  (0.3)* rnorm(n=total.n.12_18, mean=10, sd=10)
screen.12_18 <- replace(screen.12_18, screen.12_18<0, 0)
screen.12_18[sample(1:length(screen.12_18), 
                    size = (total.n.12_18-screen.n.12_18), replace = FALSE)] <- NA
hist(screen.12_18)
sd(screen.12_18, na.rm = TRUE)
mean(screen.12_18, na.rm = TRUE)
# Sim mean typically hovers between 17-19.5
# Original mean: 18.8

# set.seed(0)
screen.19_25 <- (0.7)* rnorm(n=total.n.19_25, mean=(screen.mean.19_25-7), sd=screen.sd.19_25) + 
  (0.3)* rnorm(n=total.n.19_25, mean=15, sd=10)
screen.19_25 <- rnorm(n=total.n.19_25, mean=(25.18-7), sd=37.46)
screen.19_25 <- replace(screen.19_25, screen.19_25<0, 0)
screen.19_25[sample(1:length(screen.19_25), 
                    size = (total.n.19_25-screen.n.19_25), replace = FALSE)] <- NA
hist(screen.19_25)
sd(screen.19_25, na.rm = TRUE)
mean(screen.19_25, na.rm = TRUE)
# Final mean typically hovers between 24-28
# Original mean: 25.18

# set.seed(0)
screen.26_36 <- (0.7)* rnorm(n=total.n.26_36, mean=(screen.mean.26_36), sd=screen.sd.26_36) + 
  (0.3)* rnorm(n=total.n.26_36, mean=40, sd=10)
screen.26_36 <- replace(screen.26_36, screen.26_36<0, 0)
screen.26_36[sample(1:length(screen.26_36), 
                    size = (total.n.26_36-screen.n.26_36), replace = FALSE)] <- NA
hist(screen.26_36)
sd(screen.26_36, na.rm = TRUE)
mean(screen.26_36, na.rm = TRUE)
# Final mean typically hovers between 41-48
# Original mean: 44.11

hist(screen.6_11)
hist(screen.12_18)
hist(screen.19_25)
hist(screen.26_36)

screentime <- c(screen.6_11, screen.12_18, screen.19_25, screen.26_36)
hist(screentime)

# vectors with imputed data for future simulation needs
impute_screen.6_11 <- replace(screen.6_11, is.na(screen.6_11), 
                              mean(screen.6_11, na.rm=TRUE))
impute_screen.12_18 <- replace(screen.12_18, is.na(screen.12_18), 
                               mean(screen.12_18, na.rm=TRUE))
impute_screen.19_25 <- replace(screen.19_25, is.na(screen.19_25), 
                               mean(screen.19_25, na.rm=TRUE))
impute_screen.26_36 <- replace(screen.26_36, is.na(screen.26_36), 
                               mean(screen.26_36, na.rm=TRUE))

```
*For each age group*, the following steps were taken: 

1. Use rnorm to simulate data with the total n for the age group, discounting NA's for the time being, because we need the full indices in order to combine into a later df with age. 
2. Replace negative values with 0. Because this will raise the mean, I lowered the initial mean chosen with rnorm. 
3. Add in NA values based on the difference in the total n and the n for touchscreen use. 

**Note:** The final standard deviation values are not ideal using this procedure, but I decided that staying closer to the true mean (found in the original data set) was more important.


## Sex
```{r}
sex.6_11 <- rep(x = "Female", times = total.n.6_11)
sex.6_11[sample(1:length(sex.6_11), size=ceiling(total.n.6_11*0.5149), 
                replace = FALSE)] <- "Male"

sex.12_18 <- rep(x = "Female", times = total.n.12_18)
sex.12_18[sample(1:length(sex.12_18), size=ceiling(total.n.12_18*0.5302), 
                 replace = FALSE)] <- "Male"


sex.19_25 <- rep(x = "Female", times = total.n.19_25)
sex.19_25[sample(1:length(sex.19_25), size=ceiling(total.n.19_25*0.5587), 
                 replace = FALSE)] <- "Male"


sex.26_36 <- rep(x = "Female", times = total.n.26_36)
sex.26_36[sample(1:length(sex.26_36), size=ceiling(total.n.26_36*0.5134), 
               replace = FALSE)] <- "Male"

sex <- c(sex.6_11, sex.12_18, sex.19_25, sex.26_36)

```

*For each age group*, the following steps were taken: 

1. Use rep to create a vector with the total length N with "Female" as each value
2. Replace "Female" with "Male" based on the percetage of the age group that is male in the original data set


## Background TV

```{r}
# N values for each age group
tv.n.6_11 <- 123
tv.n.12_18 <- 194
tv.n.19_25 <- 145
tv.n.26_36 <- 151

# Screen values for each age group

tv_sd.6_11 <- 186.08
tv_sd.12_18 <- 172.70
tv_sd.19_25 <- 162.99
tv_sd.26_36 <-183.24

tv_mean.6_11 <- 209.72
tv_mean.12_18 <- 189.62
tv_mean.19_25 <- 187.00
tv_mean.26_36 <- 219.01

# Ratio balues for each age group
tv_screen.ratio.all <- 200.27/24.45
tv_screen.ratio.6_11 <- 209.72/8.53
tv_screen.ratio.12_18 <- 189.62/18.80
tv_screen.ratio.19_25 <- 187.00/25.18
tv_screen.ratio.26_36 <- 219.01/44.11



tv.6_11 <- (0.6)*(impute_screen.6_11 * tv_screen.ratio.6_11) + 
  (0.4)*(tv_mean.6_11 + rnorm(tv.n.6_11, sd=tv_sd.6_11))
tv.6_11[sample(1:length(tv.6_11), size=(total.n.6_11-tv.n.6_11), 
               replace = FALSE)] <- NA
tv.6_11 <- replace(tv.6_11, tv.6_11<0, 0)
hist(tv.6_11)
mean(tv.6_11, na.rm=TRUE)
# Sim mean hovers between: 199-211
# Original mean: 209.72


tv.12_18 <- (0.6)*(impute_screen.12_18 * tv_screen.ratio.12_18) + 
  (0.4)*(tv_mean.12_18 + rnorm(tv.n.12_18, sd=tv_sd.12_18))
tv.12_18[sample(1:length(tv.12_18), size=(total.n.12_18-tv.n.12_18), 
                replace = FALSE)] <- NA
tv.12_18 <- replace(tv.12_18, tv.12_18<0, 0)
hist(tv.12_18)
mean(tv.12_18, na.rm=TRUE)
# Sim mean hovers between: 185-196
# Original mean: 189.62


tv.19_25 <- (0.6)*(impute_screen.19_25 * tv_screen.ratio.19_25) + 
  (0.4)*(tv_mean.19_25 + rnorm(tv.n.19_25, sd=tv_sd.19_25))
tv.19_25[sample(1:length(tv.19_25), size=(total.n.19_25-tv.n.19_25), 
                replace = FALSE)] <- NA
tv.19_25 <- replace(tv.19_25, tv.19_25<0, 0)
hist(tv.19_25)
mean(tv.19_25, na.rm=TRUE)
# Sim mean hovers between: 175-195
# Original mean: 187.00

tv.26_36 <- (0.6)*(impute_screen.26_36 * tv_screen.ratio.26_36) + 
  (0.4)*(tv_mean.26_36 + rnorm(tv.n.26_36, mean=-10, sd=tv_sd.26_36))
tv.26_36[sample(1:length(tv.26_36), size=(total.n.26_36-tv.n.26_36), 
                replace = FALSE)] <- NA
tv.26_36 <- replace(tv.26_36, tv.26_36<0, 0)
mean(tv.26_36, na.rm=TRUE)
# Sim mean hovers between: 215-225
# Original mean: 219.01


tv <- c(tv.6_11, tv.12_18, tv.19_25, tv.26_36)
hist(tv)

```

*For each age group*, the following steps were taken: 

1. Weighted values for each TV sample were created using:
- (0.6 weight) Ratio of mean background TV and mean touchscreen use * the touchscreen use vector (with imputed mean data where there were previously NAs)
- (0.4 weight) Mean TV + random noise
- For age group 26-36 months: the final simulated mean was too high, so I made the noise more likely to decrease the samples
2. Negative values were set to 0
- This adds many 0s, but I think this is reasonable, because there are plenty of parents that do not allow TV at all.
3. NAs were added based on difference in n for this feature and overall

**Note:** It would be possible to simulate this data in the manner used to simulate the screen time data, but I hypothesize that children that are more likely to use touchscreens are also more likely to be exposed to background TV. This is not stated in the article, but is an assumption I am making. If this was not my assumption, then I could simulate this data independent of the touchscreen values, just replicating the mean and SD for each age group



## Night-time sleep duration
```{r}


# Overall values for each age group
ntsleep.n.6_11 <- 116
ntsleep.n.12_18 <- 176
ntsleep.n.19_25 <- 132
ntsleep.n.26_36 <- 130

ntsleep.sd.6_11 <- 64.81
ntsleep.sd.12_18 <- 50.13
ntsleep.sd.19_25 <- 60.12
ntsleep.sd.26_36 <-61.81

ntsleep.mean.6_11 <- 637.24
ntsleep.mean.12_18 <- 647.24
ntsleep.mean.19_25 <- 651.25
ntsleep.mean.26_36 <- 643.21


# Ratio values for each age group
ntsleep_screen_ratio.6_11 <- ntsleep.mean.6_11/screen.mean.6_11
ntsleep_screen_ratio.12_18 <- ntsleep.mean.12_18/screen.mean.12_18
ntsleep_screen_ratio.19_25 <- ntsleep.mean.19_25/screen.mean.19_25
ntsleep_screen_ratio.26_36 <- ntsleep.mean.26_36/screen.mean.26_36

ntsleep.6_11 <- rtruncnorm(n=total.n.6_11, a=(ntsleep.mean.6_11-ntsleep.sd.6_11*2), 
                            b=(ntsleep.mean.6_11+ntsleep.sd.6_11*3),
                            mean=ntsleep.mean.6_11+50,
                            sd=ntsleep.sd.6_11) - 
                0.08*(impute_screen.6_11 * ntsleep_screen_ratio.6_11)
ntsleep.6_11[sample(1:length(ntsleep.6_11), size=(total.n.6_11-ntsleep.n.6_11), 
               replace = FALSE)] <- NA
hist(ntsleep.6_11)
mean(ntsleep.6_11, na.rm=TRUE)
# Sim mean hovers around: 632-643
# Original mean: 637.24

ntsleep.12_18 <- rtruncnorm(n=total.n.12_18, a=(ntsleep.mean.12_18-ntsleep.sd.12_18*2), 
                           b=(ntsleep.mean.12_18+ntsleep.sd.12_18*3),
                           mean=ntsleep.mean.12_18+60,
                           sd=ntsleep.sd.12_18) - 
                0.08*(impute_screen.12_18 * ntsleep_screen_ratio.12_18)
ntsleep.12_18[sample(1:length(ntsleep.12_18), size=(total.n.12_18-ntsleep.n.12_18), 
                    replace = FALSE)] <- NA
hist(ntsleep.12_18)
mean(ntsleep.12_18, na.rm=TRUE)
# Sim mean hovers around: 639-656
# Original mean: 647.24


ntsleep.19_25 <- rtruncnorm(n=total.n.19_25, a=(ntsleep.mean.19_25-ntsleep.sd.19_25*2), 
                            b=(ntsleep.mean.19_25+ntsleep.sd.19_25*3),
                            mean=ntsleep.mean.19_25+50,
                            sd=ntsleep.sd.19_25) - 
                0.08*(impute_screen.19_25 * ntsleep_screen_ratio.19_25)
ntsleep.19_25[sample(1:length(ntsleep.19_25), size=(total.n.19_25-ntsleep.n.19_25), 
                     replace = FALSE)] <- NA
hist(ntsleep.19_25)
mean(ntsleep.19_25, na.rm=TRUE)
# Sim mean hovers between: 641-658
# Original mean: 651.25

ntsleep.26_36 <- rtruncnorm(n=total.n.26_36, a=(ntsleep.mean.26_36-ntsleep.sd.26_36*2), 
                            b=(ntsleep.mean.26_36+ntsleep.sd.26_36*3),
                            mean=ntsleep.mean.26_36+56,
                            sd=ntsleep.sd.26_36) - 
  0.08*(impute_screen.26_36 * ntsleep_screen_ratio.26_36)
ntsleep.26_36[sample(1:length(ntsleep.26_36), size=(total.n.26_36-ntsleep.n.26_36), 
                     replace = FALSE)] <- NA
hist(ntsleep.26_36)
mean(ntsleep.26_36, na.rm=TRUE)
# Sim mean hovers around: 638-651
# Original mean: 643.21


ntsleep <- c(ntsleep.6_11, ntsleep.12_18, ntsleep.19_25, ntsleep.26_36)
hist(ntsleep)


```
*For each age group*, the following steps were taken: 

1. Weighted values for each night-time sleep duration sample were created by first creating a truncated normal distribution with a slightly higher mean than the original. 
2. A formula was used to create a value (in minutes) that was higher for samples with more touchscreen time. This value was multiplied by 0.08 and subtracted from the sample. It was only minimally influential, because the correlation between touchscreen and nighttime sleep was only -0.29. This shows that there is some correlation, but it is not particularly strong, so I didn't want to over do it. 
    - Formula: (Age Group Nighttime Sleep Mean)/(Age Group Screen Use Mean) * (Sample Screen Use)
3. NAs were added based on difference in n for this feature and overall



## Daytime sleep duration

```{r}

# Overall values for each age group
daysleep.n.6_11 <- 116
daysleep.n.12_18 <- 176
daysleep.n.19_25 <- 132
daysleep.n.26_36 <- 126

daysleep.sd.6_11 <- 47.27
daysleep.sd.12_18 <- 38.40
daysleep.sd.19_25 <- 40.28
daysleep.sd.26_36 <- 53.20

daysleep.mean.6_11 <- 139.05
daysleep.mean.12_18 <- 122.47
daysleep.mean.19_25 <- 100.57
daysleep.mean.26_36 <- 68.25


# Ratio values for each age group
daysleep.screen_ratio.6_11 <- daysleep.mean.6_11/screen.mean.6_11
daysleep.screen_ratio.12_18 <- daysleep.mean.12_18/screen.mean.12_18
daysleep.screen_ratio.19_25 <- daysleep.mean.19_25/screen.mean.19_25
daysleep.screen_ratio.26_36 <- daysleep.mean.26_36/screen.mean.26_36


daysleep.6_11 <- rtruncnorm(n=total.n.6_11, a=(daysleep.mean.6_11-daysleep.sd.6_11*3), 
                            b=(daysleep.mean.6_11+daysleep.sd.6_11*2),
                            mean=daysleep.mean.6_11-5,
                            sd=daysleep.sd.6_11) + 
            0.05*(impute_screen.6_11 * daysleep.screen_ratio.6_11)
daysleep.6_11[sample(1:length(daysleep.6_11), size=(total.n.6_11-daysleep.n.6_11),
                    replace = FALSE)] <- NA
daysleep.6_11 <- replace(daysleep.6_11, daysleep.6_11<0, 0)
mean(daysleep.6_11, na.rm = TRUE)
# Simulated mean hovers around: 128-144
# Original mean: 139.05


daysleep.12_18 <- rtruncnorm(n=total.n.12_18, a=(daysleep.mean.12_18-daysleep.sd.12_18*3), 
                            b=(daysleep.mean.12_18+daysleep.sd.12_18*2),
                            mean=daysleep.mean.12_18-5,
                            sd=daysleep.sd.12_18) + 
  0.05*(impute_screen.12_18 * daysleep.screen_ratio.12_18)
daysleep.12_18[sample(1:length(daysleep.12_18), size=(total.n.12_18-daysleep.n.12_18),
                     replace = FALSE)] <- NA
daysleep.12_18 <- replace(daysleep.12_18, daysleep.12_18<0, 0)
mean(daysleep.12_18, na.rm = TRUE)
# Simulated mean hovers around: 120-125
# Original mean: 122.47


daysleep.19_25 <- rtruncnorm(n=total.n.19_25, a=(daysleep.mean.19_25-daysleep.sd.19_25*3), 
                             b=(daysleep.mean.19_25+daysleep.sd.19_25*2),
                             mean=daysleep.mean.19_25-5,
                             sd=daysleep.sd.19_25) + 
  0.05*(impute_screen.19_25 * daysleep.screen_ratio.19_25)
daysleep.19_25[sample(1:length(daysleep.19_25), size=(total.n.19_25-daysleep.n.19_25),
                     replace = FALSE)] <- NA
daysleep.19_25 <- replace(daysleep.19_25, daysleep.19_25<0, 0)
mean(daysleep.19_25, na.rm = TRUE)
# Simulated mean hovers around: 97-102
# Original mean: 100.57


daysleep.26_36 <- rtruncnorm(n=total.n.26_36, a=(daysleep.mean.26_36-daysleep.sd.26_36*3), 
                             b=(daysleep.mean.26_36+daysleep.sd.26_36*2),
                             mean=daysleep.mean.26_36-4,
                             sd=daysleep.sd.26_36) + 
  0.05*(impute_screen.26_36 * daysleep.screen_ratio.26_36)
daysleep.26_36[sample(1:length(daysleep.26_36), size=(total.n.26_36-daysleep.n.26_36),
                     replace = FALSE)] <- NA
daysleep.26_36 <- replace(daysleep.26_36, daysleep.26_36<0, 0)
mean(daysleep.26_36, na.rm = TRUE)
# Simulated mean hovers around: 59-78
# Original mean: 68.25


daysleep <- c(daysleep.6_11, daysleep.12_18, daysleep.19_25, daysleep.26_36)
hist(daysleep)
mean(daysleep, na.rm=TRUE)
# Simulated mean: 106.32
# Original mean: 108.29


```
*For each age group*, the following steps were taken: 

1. Weighted values for each daytime sleep duration sample were created by first creating a truncated normal distribution with a slightly higher mean than the original. 
2. A formula was used to create a value (in minutes) that was higher for samples with more touchscreen time. This value was multiplied by 0.05 and subtracted from the sample. It was only minimally influential, because the correlation between touchscreen and nighttime sleep was only 0.14. This shows that there is some correlation, but it is not particularly strong, so I didn't want to over do it. 
    - Formula: (Age Group Daytime Sleep Mean)/(Age Group Screen Use Mean) * (Sample Screen Use)
3. NAs were added based on difference in n for this feature and overall

## Total Sleep
```{r}

totalsleep <- ntsleep+daysleep

```


## Average number of night awakenings
```{r}

# Age means 
age.mean.6_11 <- 8.99
age.mean.12_18 <- 14.40
age.mean.19_25 <- 21.94
age.mean.26_36 <- 30.64


# Overall values for each age group

wake.n.6_11 <- 116
wake.n.12_18 <- 177
wake.n.19_25 <- 133
wake.n.26_36 <- 130

wake.sd.6_11 <- 1.73
wake.sd.12_18 <- 1.33
wake.sd.19_25 <- 1.01
wake.sd.26_36 <- 0.81

wake.mean.6_11 <- 2
wake.mean.12_18 <- 1.29
wake.mean.19_25 <- 0.91
wake.mean.26_36 <- 0.58


# Ratio values for each age group
wake.age_ratio.6_11 <- wake.mean.6_11/age.mean.6_11
wake.age_ratio.12_18 <- wake.mean.12_18/age.mean.12_18
wake.age_ratio.19_25 <- wake.mean.19_25/age.mean.19_25
wake.age_ratio.26_36 <- wake.mean.26_36/age.mean.26_36


wake.6_11 <- floor(rtruncnorm(n=total.n.6_11, a=(wake.mean.6_11-wake.sd.6_11*2), 
                            b=(wake.mean.6_11+wake.sd.6_11*3),
                            mean=wake.mean.6_11+0.75,
                            sd=wake.sd.6_11) - 
                  0.15*(impute.age.6_11 * wake.age_ratio.6_11))
wake.6_11[sample(1:length(wake.6_11), size=(total.n.6_11-wake.n.6_11),
                     replace = FALSE)] <- NA
wake.6_11 <- replace(wake.6_11, wake.6_11<0, 0)
mean(wake.6_11, na.rm = TRUE)
# Simulated mean hovers around: 1.75-2.19
# Original mean: 2


wake.12_18 <- floor(rtruncnorm(n=total.n.12_18, a=(wake.mean.12_18-wake.sd.12_18*2), 
                              b=(wake.mean.12_18+wake.sd.12_18*3),
                              mean=wake.mean.12_18+0.6,
                              sd=wake.sd.12_18) - 
                     0.15*(impute.age.12_18 * wake.age_ratio.12_18))
wake.12_18[sample(1:length(wake.12_18), size=(total.n.12_18-wake.n.12_18),
                      replace = FALSE)] <- NA
wake.12_18 <- replace(wake.12_18, wake.12_18<0, 0)
mean(wake.12_18, na.rm = TRUE)
# Simulated mean hovers around: 1.23-1.37
# Original mean: 1.29


wake.19_25 <- floor(rtruncnorm(n=total.n.19_25, a=(wake.mean.19_25-wake.sd.19_25*2), 
                               b=(wake.mean.19_25+wake.sd.19_25*3),
                               mean=wake.mean.19_25+0.55,
                               sd=wake.sd.19_25) - 
                      0.15*(impute.age.19_25 * wake.age_ratio.19_25))
wake.19_25[sample(1:length(wake.19_25), size=(total.n.19_25-wake.n.19_25),
                      replace = FALSE)] <- NA
wake.19_25 <- replace(wake.19_25, wake.19_25<0, 0)
mean(wake.19_25, na.rm = TRUE)
# Simulated mean hovers around: 0.85-1.06
# Original mean: 0.91


wake.26_36 <- floor(rtruncnorm(n=total.n.26_36, a=(wake.mean.26_36-wake.sd.26_36*2), 
                               b=(wake.mean.26_36+wake.sd.26_36*3),
                               mean=wake.mean.26_36+0.55,
                               sd=wake.sd.26_36) - 
                      0.15*(impute.age.26_36 * wake.age_ratio.26_36))
wake.26_36[sample(1:length(wake.26_36), size=(total.n.26_36-wake.n.26_36),
                      replace = FALSE)] <- NA
wake.26_36 <- replace(wake.26_36, wake.26_36<0, 0)
mean(wake.26_36, na.rm = TRUE)
# Simulated mean hovers around: 0.53-0.67
# Original mean: 0.58


wake <- c(wake.6_11, wake.12_18, wake.19_25, wake.26_36)
mean(wake, na.rm=TRUE)
# Sim mean: 1.23
# Original mean: 1.17

```
*For each age group*, the following steps were taken: 

1. Weighted values for each daytime sleep duration sample were created by first creating a truncated normal distribution with a slightly higher mean than the original. 
2. A formula was used to create a value (in minutes) that was *higher for samples with higher age*. Age was chosen in this simulation, because the original study shows that there is no significant correlation between screentime and average number of awakenings.  This value was multiplied by 0.15 and subtracted from sample. It was only minimally influential (although more influential than most variables), because the correlation between age and awakenings was -0.35. This shows that there is some correlation, but it is not particularly strong, so I didn't want to over do it. 
    - Formula: (Age Group Awakenings Mean)/(Age Group Age Mean) * (Sample Age)
3. NAs were added based on difference in n for this feature and overall

## Sleep onset
```{r}


# Ratio values for each age group
onset.screen_ratio.6_11 <- onset.mean.6_11/screen.mean.6_11
onset.screen_ratio.12_18 <- onset.mean.12_18/screen.mean.12_18
onset.screen_ratio.19_25 <- onset.mean.19_25/screen.mean.19_25
onset.screen_ratio.26_36 <- onset.mean.26_36/screen.mean.26_36



onset.6_11 <- rtruncnorm(n=total.n.6_11, a=(onset.mean.6_11-onset.sd.6_11*3), 
                            b=(onset.mean.6_11+onset.sd.6_11*2),
                            mean=onset.mean.6_11-5,
                            sd=onset.sd.6_11) + 
  0.07*(impute_screen.6_11 * onset.screen_ratio.6_11)
onset.6_11[sample(1:length(onset.6_11), size=(total.n.6_11-onset.n.6_11),
                     replace = FALSE)] <- NA
onset.6_11 <- replace(onset.6_11, onset.6_11<0, 0)
mean(onset.6_11, na.rm = TRUE)
# Simulated mean hovers around: 19.5-23.5
# Original mean: 22.8


onset.12_18 <- rtruncnorm(n=total.n.12_18, a=(onset.mean.12_18-onset.sd.12_18*3), 
                         b=(onset.mean.12_18+onset.sd.12_18*2),
                         mean=onset.mean.12_18-3,
                         sd=onset.sd.12_18) + 
  0.07*(impute_screen.12_18 * onset.screen_ratio.12_18)
onset.12_18[sample(1:length(onset.12_18), size=(total.n.12_18-onset.n.12_18),
                      replace = FALSE)] <- NA
onset.12_18 <- replace(onset.12_18, onset.12_18<0, 0)
mean(onset.12_18, na.rm = TRUE)
# Simulated mean hovers around: 19.5-22.5
# Original mean: 21.54


onset.19_25 <- rtruncnorm(n=total.n.19_25, a=(onset.mean.19_25-onset.sd.19_25*3), 
                         b=(onset.mean.19_25+onset.sd.19_25*2),
                         mean=onset.mean.19_25-1.5,
                         sd=onset.sd.19_25) + 
  0.07*(impute_screen.19_25 * onset.screen_ratio.19_25)
onset.19_25[sample(1:length(onset.19_25), size=(total.n.19_25-onset.n.19_25),
                      replace = FALSE)] <- NA
onset.19_25 <- replace(onset.19_25, onset.19_25<0, 0)
mean(onset.19_25, na.rm = TRUE)
# Simulated mean hovers around: 20-24
# Original mean: 22.22


onset.26_36 <- rtruncnorm(n=total.n.26_36, a=(onset.mean.26_36-onset.sd.26_36*3), 
                         b=(onset.mean.26_36+onset.sd.26_36*2),
                         mean=onset.mean.26_36-3.5,
                         sd=onset.sd.26_36) + 
  0.07*(impute_screen.26_36 * onset.screen_ratio.26_36)
onset.26_36[sample(1:length(onset.26_36), size=(total.n.26_36-onset.n.26_36),
                      replace = FALSE)] <- NA
onset.26_36 <- replace(onset.26_36, onset.26_36<0, 0)
mean(onset.26_36, na.rm = TRUE)
# Simulated mean hovers around: 27-32
# Original mean: 29.34


onset <- c(onset.6_11, onset.12_18, onset.19_25, onset.26_36)
mean(onset, na.rm=TRUE)
# Simulated mean: 23.16
# Original mean: 23.79

```
*For each age group*, the following steps were taken: 

1. Weighted values for each daytime sleep duration sample were created by first creating a truncated normal distribution with a slightly higher mean than the original. 
2. A formula was used to create a value (in minutes) that was higher for samples with more touchscreen time. This value was multiplied by 0.07 and subtracted from the sample. It was only minimally influential, because the correlation between touchscreen and nighttime sleep was only 0.21. This shows that there is some correlation, but it is not particularly strong, so I didn't want to over do it. 
    - Formula: (Age Group Daytime Sleep Mean)/(Age Group Screen Use Mean) * (Sample Screen Use)
3. NAs were added based on difference in n for this feature and overall

# Data Exploration

```{r}

df <- data.frame(age, sex, tv, screentime, ntsleep, daysleep, totalsleep, wake, onset)

df$age_category <- factor(rep(x = "26-36 months", times=length(df$age)), 
                             levels = c("6-11 months", "12-18 months", 
                                        "19-25 months", "26-36 months"))
df$age_category[df$age < 26] <- "19-25 months"
df$age_category[df$age < 19] <- "12-18 months"
df$age_category[df$age < 12] <- "6-11 months"

```

## Testing for normality
```{r}
shapiro.test(age)
shapiro.test(tv)
shapiro.test(screentime)
shapiro.test(ntsleep)
shapiro.test(daysleep)
shapiro.test(wake)
shapiro.test(onset)
```
In the original data, only the nightsleep (ntsleep) and daytime sleep (daysleep) are normally distributed. According to this shapiro wilks test, however, all of my data is normal. Considering that the rest of the metrics are okay, I am okay with this fact. 


## Correlations

```{r}
library(corrplot)
cor.mtest <- function(mat, conf.level = 0.95){
  mat <- as.matrix(mat)
  n <- ncol(mat)
  p.mat <- lowCI.mat <- uppCI.mat <- matrix(NA, n, n)
  diag(p.mat) <- 0
  diag(lowCI.mat) <- diag(uppCI.mat) <- 1
  for(i in 1:(n-1)){
    for(j in (i+1):n){
      tmp <- cor.test(mat[,i], mat[,j], conf.level = conf.level)
      p.mat[i,j] <- p.mat[j,i] <- tmp$p.value
      lowCI.mat[i,j] <- lowCI.mat[j,i] <- tmp$conf.int[1]
      uppCI.mat[i,j] <- uppCI.mat[j,i] <- tmp$conf.int[2]
    }
  }
  return(list(p.mat, lowCI.mat, uppCI.mat))
}

df_nocat <- data.frame(age, tv, screentime, ntsleep, daysleep, totalsleep, wake, onset)
cor1 <- cor.mtest(df_nocat, 0.95)
corrplot(cor(df_nocat, use = "complete.obs"), p.mat = cor1[[1]], type='lower', sig.level = 0.5)
corrplot(cor(df_nocat, use = "complete.obs"), method = 'number', p.mat = cor1[[1]], type='lower', sig.level = 0.5, bg='gray72')
```

These corrplots show us the same information in different formats. The first plot is visualized with shapes, while the second with numbers. The boxes marked with X's represent insignificant correlations with a p < 0.05. 

**Positive correlations:**
First of all, total sleep and nighttime sleep are heavily positively correlated while daytime sleep and total sleep are minimally correlated. Additionally, tv and touchscreen time is moderately correlated. Considering that TV was based partially on screentime in my simulation, this is expected. Other positively correlated variables include moderate correlation between touchscreen time and age, which is reasonable. 

*Minimal:* There are many minimal correlations between onset and tv, screentime, and age. Finally, there are minimal correlations between tv and daysleep, and number of nighttime awakenings and day sleep. 

**Negative correlations:**
There are moderate to strong correlations between nighttime sleep and tv and touchscreen time along with total sleep and tv and touchscreen time. There is a moderate correlation between age and daysleep and number of night awakenings. 

*Minimal:* There are a few minimal correlations as follows: total sleep and age, awakenings, and screentime, daysleep and night sleep, and onset of sleep and daysleep. 

## Data Visualization

### General Distributions
```{r error=TRUE}
ggplot(data=df, aes(x=age_category)) + 
  geom_bar() + 
  labs(title = "Number of patients in each age category",
       x = "Age Category",
       y = "Count")
```
```{r error=TRUE}

ggplot(data=df, aes(x=screentime)) + 
  geom_histogram() + 
  labs(title = "Distribution of Touchscreen Time",
       x = "Touchscreen Time (Minutes)", 
       y = "Count")
```
```{r error=TRUE}
ggplot(data=df, aes(x=ntsleep)) + 
  geom_histogram() + 
  labs(title = "Distribution of Nighttime Sleep",
       x = "Nighttime Sleep (Minutes)", 
       y = "Count")
```
```{r error=TRUE}
ggplot(data=df, aes(x=daysleep)) + 
  geom_histogram() + 
  labs(title = "Distribution of Daytime Sleep",
       x = "Daytime Sleep (Minutes)", 
       y = "Count")
```
```{r error=TRUE}
ggplot(data=df, aes(x=onset)) + 
  geom_histogram() + 
  labs(title = "Distribution of Onset of Sleep",
       x = "Time to Fall Asleep (Minutes)", 
       y = "Count")

```

```{r error=TRUE}
ggplot(data=df, aes(x=tv)) + 
  geom_histogram() + 
  labs(title = "Distribution of Background TV Time",
       x = "Background TV Time (Minutes)", 
       y = "Count")
```

### Scatter plots
```{r error=TRUE}
ggplot(data=df, aes(x=screentime, y=daysleep, color=age_category)) +
  geom_point() +
  labs(title = "Daytime Sleep vs. Touchscreen Use", 
       y = "Day time sleep (minutes)", 
       x = "Touchscreen Time")
```

This shows that touchscreen time has a slightly positive correlation with day time sleep in all age categories. The corrplot (which doesn't separate by age category) shows a nearly non-existent negative correlation between these two variables (0.03)

```{r error=TRUE}
ggplot(data=df, aes(x=tv, y=wake, color=age_category)) + 
  geom_point() +
  labs(title = "Background TV vs. Touchscreen Use", 
       y = "Avg. Number of Awakenings", 
       x = "Background TV (minutes)")
```

These are more difficult to read, but it does show that more nighttime awakenings (>3) are almost exclusively associated with the lowest two age categories. 

Additionally, background TV doesn't appear to be associated with average awakenings, but due to the crowding of this plot, it is not a good method for making this conclusion. 

### Density Plots
```{r error=TRUE}
ggplot(data=df, aes(x=screentime, color=age_category, fill=age_category)) + 
  geom_density(alpha=0.5) + 
  labs(title = "Touchscreen Use by Age Category", 
       x = "Touchscreen Use (minutes)")
# Touchscreen use certainly increases with age, with the smallest differences between the 
# 12-18 and 19-25 month categories

ggplot(data=df, aes(x=tv, color=age_category, fill=age_category)) + 
  geom_density(alpha=0.5) + 
  labs(title = "Background TV by Age Category", 
       x = "Background TV (minutes)")
# Similar background TV use by age group, but slightly higher in the oldest 

ggplot(data=df, aes(x=daysleep, color=age_category, fill=age_category)) + 
  geom_density(alpha=0.5) + 
  labs(title = "Daysleep by Age Category", 
       x = "Time spend asleep during the day (minutes)")
# Although the distribution is rather spread out, it is clear that sleeping during the day
# decreases with age

ggplot(data=df, aes(x=wake, color=age_category, fill=age_category)) + 
  geom_density(alpha=0.5) + 
  labs(title = "Daysleep by Age Category", 
       x = "Time spend asleep during the day (minutes)")
# Although the distribution is rather spread out, average number of nighttime
# awakenings does decreases with age

ggplot(data=df, aes(x=wake)) + 
  geom_histogram() + 
  facet_wrap(~age_category)
# Confirms that the average number of awakenings as a group decreases with age

ggplot(data=df, aes(x=tv, color=sex, fill=sex)) + 
  geom_density(alpha=0.5) + 
  labs(title = "Background TV by Sex", 
       x = "Background TV (minutes)")
# Female infants have slightly less background TV than males

ggplot(data=df, aes(x=screentime, color=sex, fill=sex)) + 
  geom_density(alpha=0.5) + 
  labs(title = "Touchscreen Time by Sex", 
       x = "Touchscreen Time (minutes)")
# Female infants have slightly less background TV than males
```

# Modeling

## Basic Regression

**Predicting touchscreen use:**
```{r error=TRUE}
lm.screen1 <- lm(data=df, screentime~.)
summary(lm.screen1)
# Residual standard error: 11.83 on 214 degrees of freedom
# Adjusted R-squared:  0.7794 
# p-value: < 2.2e-16
  # Shows us that nighttime sleep, daysleep, and some of the age categories
  # are the only significant variables in determining the amount of time
  # spend on a touchscreen. With ~20 variables/feature this model is unlikely 
  # to be overfit. 
```

```{r error=TRUE}
lm.screen2 <- lm(data=df, screentime~ntsleep+daysleep+age_category)
summary(lm.screen2)
# Residual standard error: 17.42 on 367 degrees of freedom
# Adjusted R-squared:  0.5726 
# p-value: < 2.2e-16
  # Although nearly all the variables are significant, the R-squared is much lower
```


```{r error=TRUE}
lm.screen3 <- lm(data=df, screentime~ntsleep*daysleep*age_category)
summary(lm.screen3)
# Residual standard error: 16.07 on 357 degrees of freedom
# Adjusted R-squared:  0.6364 
# p-value: < 2.2e-16
  # Here the adjusted r-squared is improved, but the variables aren't significant
```

```{r error=TRUE}
lm.screen4 <- lm(data=df, screentime~ntsleep*daysleep + age_category+sex)
summary(lm.screen4)
# Residual standard error: 17.4 on 365 degrees of freedom
# Adjusted R-squared:  0.5737 
# p-value: < 2.2e-16
  # Here, again, we see that more of the variables are significant, but the 
  # adjusted r-squared is worsened 
```

```{r error=TRUE}
lm.screen5 <- lm(data=df, screentime~.-wake)
summary(lm.screen5)
# Residual standard error: 11.8 on 215 degrees of freedom
# Adjusted R-squared:  0.7803 
# p-value: < 2.2e-16
  # With this I decided to take out only the most insignificant variable, 
  # and that improved the adjusted r-squared very slightly
```

```{r error=TRUE}
lm.screen6 <- lm(data=df, screentime~.-wake-daysleep)
summary(lm.screen6)
# Residual standard error: 11.8 on 215 degrees of freedom
# Adjusted R-squared:  0.7803 
# p-value: < 2.2e-16
  # No change to adjusted r-squared, but it simplifies the model
```

```{r error=TRUE}
lm.screen7 <- lm(data=df, screentime~.-wake-daysleep-totalsleep)
summary(lm.screen7)
# Residual standard error: 11.78 on 216 degrees of freedom
# Adjusted R-squared:  0.7813 
# p-value: < 2.2e-16
# Improved R-squared
```

```{r error=TRUE}
lm.screen8 <- lm(data=df, screentime~.-wake-daysleep-totalsleep-onset-age)
summary(lm.screen8)
# Residual standard error: 11.77 on 217 degrees of freedom
# Adjusted R-squared:  0.7816 
# p-value: < 2.2e-16
  # Very slight improvement to R-squared
```

```{r error=TRUE}
lm.screen9 <- lm(data=df, screentime~tv+ntsleep*age_category)
summary(lm.screen9)
# Residual standard error: 11.63 on 404 degrees of freedom
# Adjusted R-squared:  0.8196 
# p-value: < 2.2e-16
  # Best rsquared value yet
```
This is our best model


**Predicting nighttime sleep:**
```{r error=TRUE}

lm.ntsleep1 <- lm(data=df, ntsleep~.-totalsleep)
summary(lm.ntsleep1)
# Residual standard error: 55.68 on 214 degrees of freedom
# Adjusted R-squared:  0.4924 
# p-value: < 2.2e-16
  # This is a reasonable starting point, and there are only a few significant
  # variables so I'll start by removing those
```

```{r error=TRUE}
lm.ntsleep2 <- lm(data=df, ntsleep~screentime+daysleep+age_category+onset)
summary(lm.ntsleep2)
# Residual standard error: 56.87 on 316 degrees of freedom
# Adjusted R-squared:  0.4433 
# p-value: < 2.2e-16
  # Decreased r-squared
```

```{r error=TRUE}
lm.ntsleep3 <- lm(data=df, ntsleep~screentime*age_category)
summary(lm.ntsleep3)
# Residual standard error: 52.56 on 472 degrees of freedom
# Adjusted R-squared:  0.5037 
# p-value: < 2.2e-16
  # Improved r-squared and all significant variables
```

```{r error=TRUE}
lm.ntsleep4 <- lm(data=df, ntsleep~screentime*age_category+tv)
summary(lm.ntsleep4)
# Residual standard error: 52.24 on 404 degrees of freedom
# Adjusted R-squared:  0.5124 
# p-value: < 2.2e-16
  # Improved r-squared
  # tv isn't a significant variable, but it does improve the r-squared
  # value
```
This is our best model


```{r error=TRUE}
lm.ntsleep5 <- lm(data=df, ntsleep~screentime*age_category*tv)
summary(lm.ntsleep5)
# Residual standard error: 52.34 on 397 degrees of freedom
# Adjusted R-squared:  0.5107 
# p-value: < 2.2e-16
  # Significantly worsened p-values, and slightly worsened adjusted
  # r-squared

# Shows us that age category and screentime are the most important in determining
# nighttime sleep
```


**Predicting average number of nighttime awakenings:**
```{r error=TRUE}

lm.wake1 <- lm(data=df, wake~.)
summary(lm.wake1)
# Residual standard error: 1.208 on 214 degrees of freedom
# Adjusted R-squared:  0.1259 
# p-value: 2.262e-05
```

```{r error=TRUE}
lm.wake2 <- lm(data=df, wake~sex+age_category+onset)
summary(lm.wake2)
# Residual standard error: 1.124 on 457 degrees of freedom
# Adjusted R-squared:  0.1271 
# p-value: 3.724e-13
```
This is our best model

**Predicting sleep onset:**
```{r error=TRUE}
lm.onset1 <- lm(data=df, onset~.)
summary(lm.onset1)
# Residual standard error: 10.68 on 214 degrees of freedom
# Adjusted R-squared:  0.08727 
# p-value: 0.0009048
```

```{r error=TRUE}
lm.onset2 <- lm(data=df, onset~tv+age_category+ntsleep)
summary(lm.onset2)
# Residual standard error: 11.07 on 406 degrees of freedom
# Adjusted R-squared:  0.1066 
# p-value: 8.957e-10
  # Still a very poor r-squared
```

```{r error=TRUE}
lm.onset3 <- lm(data=df, onset~tv+age_category)
summary(lm.onset3)
# Residual standard error: 11.22 on 512 degrees of freedom
# Adjusted R-squared:  0.1088 
# p-value: 6.588e-13

```
This is our best model

**Predicting daytime sleep:**
```{r}
lm.daysleep1 <- lm(data=df, daysleep~.-totalsleep)
summary(lm.daysleep1)
# Residual standard error: 41.62 on 214 degrees of freedom
# Adjusted R-squared:  0.1404 
# p-value: 5.166e-06
```
No significant variables, I will take the most significant (< 0.2)
for the next model

```{r}
lm.daysleep2 <- lm(data=df, daysleep~age+sex+tv)
summary(lm.daysleep2)
# Residual standard error: 40.55 on 471 degrees of freedom
# Adjusted R-squared:  0.2564 
# p-value: < 2.2e-16
```
All significant variables
  
```{r}
lm.daysleep3 <- lm(data=df, daysleep~age_category+sex+tv)
summary(lm.daysleep3)  
# Residual standard error: 40.06 on 469 degrees of freedom
# Adjusted R-squared:  0.2743 
# p-value: < 2.2e-16
```
Slightly improved r-squared, all variables are still significant (p<0.05)
This is our best model

```{r}
lm.daysleep4 <- lm(data=df, daysleep~age_category*tv+sex)
summary(lm.daysleep4)  
# Residual standard error: 40.08 on 466 degrees of freedom
# Adjusted R-squared:  0.2735 
# p-value: < 2.2e-16
```
Slightly worsened adjusted r-squared and more complex model

## Multivariate Multiple Regression

```{r error=TRUE}

age_category <- df$age_category

dep.vars <- cbind(ntsleep, daysleep, wake, onset)
ind.vars <- cbind(sex, tv, screentime, age_category)

lm.all1 <- lm(data=df, dep.vars~sex+tv+screentime+age_category)
summary(lm.all1)
# This isn't as specific as simply doing it by hand, since it's more 
# difficult to customize to each outcome variable. Each variable also
# isn't considered interconnected. 

```

## Path Analysis

We need to know how many samples are in the correlations, so I am going to run one of the models to determine how many
samples are deleted due to missingness.
```{r error=TRUE}
lm1 <- lm(data=df, ntsleep~daysleep+wake+onset+age+tv+screentime)
summary(lm1)
# 490 samples deleted, 715-490 = 225 samples
n_samples = 225
```

```{r error=TRUE}
install.packages('lavaan')
require(lavaan)
correlations <- cor(df_nocat, use = "complete.obs")
correlations
model1 <- 'ntsleep~daysleep+wake+onset+age+tv+screentime
daysleep~ntsleep+wake+onset+age+tv+screentime
wake~ntsleep+daysleep+onset+age+tv+screentime
onset~ntsleep+daysleep+wake+age+tv+screentime'
results1<-sem(model1,sample.cov=correlations,sample.nobs=n_samples)
```


This error is the result of a poor model, because it cannot have features mutually relying on
each other. Unfortunately, this is what I thought was the best part of doing a path
analysis. For example, we cannot have ntsleep~daysleep+etc and daysleep~ntsleep+etc
Although I understand how this is predictably very difficult, that would help us simulate
real data.

More complex models were not working, so I started by simplifying the model significantly...
```{r}
model2 <- 'ntsleep~daysleep+wake+onset+age+tv+screentime
daysleep~ntsleep+wake'
results2<-sem(model2,sample.cov=correlations,sample.nobs=n_samples)
summary(results2,standardized=T,fit=T,rsquare=T)
# R-Square:
# ntsleep           0.442
# daysleep          0.009

model3 <- 'ntsleep~daysleep+wake+onset+age+tv+screentime
wake~ntsleep+daysleep+onset'
results3<-sem(model3,sample.cov=correlations,sample.nobs=n_samples)
summary(results3,standardized=T,fit=T,rsquare=T)
# R-Square:
# ntsleep           0.435
# wake             -0.004

model4 <- 'ntsleep~daysleep+wake+onset+age+tv+screentime
onset~ntsleep+daysleep+wake'
results4<-sem(model4,sample.cov=correlations,sample.nobs=n_samples)
summary(results4,standardized=T,fit=T,rsquare=T)
# R-Square:
# ntsleep           0.441
# onset             0.000
```

Making a more complex model
```{r}
model5 <- 'ntsleep~daysleep+wake+onset+age+tv+screentime
daysleep~wake+onset+age+tv+screentime
wake~onset+age+tv+screentime
onset~age+tv+screentime'
results5<-sem(model5,sample.cov=correlations,sample.nobs=n_samples)
summary(results5,standardized=T,fit=T,rsquare=T)

# R-Square:
# ntsleep           0.443
# daysleep          0.243
# wake              0.109
# onset             0.018
```

Although these results are not "bad," looking deeper at the insignificant
results shows us that each of the outcome variables is not a significant
feature in other predictions. In other words, daysleep, wake, and onset
(theoretically predictor AND outcome variables) are not significant
when performing a linear regression predicting ntsleep.


# Discussion

Performing a simulated analysis on this data was difficult given a number of
factors: 
1. NA values significantly decreased sample size
2. We cannot be sure what software was used in the original article
3. A mix of categorical and numeric variables made some analyses impossible 
  * e.g. Path analysis with lavaan package and age_category as predictor variable
  
After simulating the data and reading the article, I believe that ntsleep is one
of the most important outcome variables. This is because it comprises the majority 
of an infants time asleep. 

For this reason, I believe that **lm.ntsleep4 is the most important**. Of note, 
it was much easier to explain the variance in the data when using screentime as an
outcome variable instead of a predictor variable as originally stipulated by the 
article. This is because the r-squared values when predicting screentime are much
higher than when predicting any of the intended outcome variables.

Although the path analysis did not work out as intended, I believe it is possible to 
simulate the article's path analysis figure (Figure 1.) simply using the correlation
matrix data. 

Here is a simulated version of what the correlations between our variables tells us...
![Simulated Path Analysis Visualization](path_image.png)

This image shows us that my data is significantly more correlated than the original data which had much fewer significant correlations between variables. The original path only has significant correlations between the following features: 
* Tablet use and night-time sleep duration, daytime sleep duration, and sleep latency
* TV exposure and daytime sleep duration
* Age and night-time sleep duration, daytime sleep duration, and frequency of night-time awakenings
* Sex and daytime sleep duration

Additionally, my correlations are generally much stronger than what is seen in the original data. These extra correlations and stronger correlations are reasonable, because the original data probably contain much more randomness from external factors (genetics, environment, etc), than mine do. 

Unfortunately, two of the simulated correlations are opposite from the original correlations. For example, tablet use vs daytime sleep is originally positively correlated (r=0.14) while my simulation shows a negative correlation (r=-0.15). A similar issue regarding opposite correlations is seen between TV exposure and daytime sleep duration (original r=-0.09, simulated 0.12).  

To conclude, the simulated data shows significant correlations between much of these variables, showing that they are interconnected in predicting the outcome of worsened sleep habits. 